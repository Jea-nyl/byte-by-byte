<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Settings - Byte by Byte</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body {
  font-family: Arial, sans-serif;
  background: #0f172a;
  color: white;
  text-align: center;
  padding: 20px;
}
h1 { color:#fde047; }
.settingItem {
  background:#1e293b;
  padding:20px;
  margin:10px auto;
  width:300px;
  border-radius:12px;
  font-size:1.5rem;
  transition: background 0.3s;
}
.active { background:#fde047; color:black; }
.selected { border: 3px solid #22c55e; }
</style>
</head>
<body>
<h1>‚öôÔ∏è Settings</h1>

<div id="settings">
  <div class="settingItem active" data-key="answerTime">Answer Time: <span id="answerTimeDisplay"></span>s</div>
  <div class="settingItem" data-key="revealTime">Reveal Time: <span id="revealTimeDisplay"></span>s</div>
</div>

<p>Use A/B to move/change, C to select/unselect, D to save & return</p>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getDatabase, ref, onValue, set } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

/* üî• FIREBASE CONFIG */
const firebaseConfig = {
  apiKey: "AIzaSyBkFUpf2JuYIch95wx9B4Rk-jp9I7IudJs",
  authDomain: "byte-by-byte-f7a4c.firebaseapp.com",
  databaseURL: "https://byte-by-byte-f7a4c-default-rtdb.firebaseio.com",
  projectId: "byte-by-byte-f7a4c",
  storageBucket: "byte-by-byte-f7a4c.firebasestorage.app",
  messagingSenderId: "838552047744",
  appId: "1:838552047744:web:f653b9fba96e49d665"
};

/* üîå INITIALIZE FIREBASE */
const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const controlRef = ref(db,"control");

/* ‚öôÔ∏è SETTINGS LOGIC */
const settingsItems = Array.from(document.querySelectorAll(".settingItem"));
let currentIndex = 0;
let selectedIndex = null;

// Load from localStorage or defaults
let answerTime = parseInt(localStorage.getItem("answerTime")) || 10;
let revealTime = parseInt(localStorage.getItem("revealTime")) || 5;

const answerTimeDisplay = document.getElementById("answerTimeDisplay");
const revealTimeDisplay = document.getElementById("revealTimeDisplay");

function updateDisplay() {
  answerTimeDisplay.textContent = answerTime;
  revealTimeDisplay.textContent = revealTime;
}

function updateActive() {
  settingsItems.forEach((el,i)=>{
    el.classList.toggle("active", i===currentIndex);
    el.classList.toggle("selected", i===selectedIndex);
  });
}

updateDisplay();
updateActive();

/* üîå ESP32 BUTTON CONTROLS */
onValue(controlRef, snapshot => {
  const data = snapshot.val();
  if(!data || !data.button) return;
  const btn = data.button;
  set(controlRef,{button:""}); // reset

  const currentItem = settingsItems[currentIndex];
  const key = currentItem.dataset.key;

  if(btn==="C"){ // toggle select/unselect
    if(selectedIndex===currentIndex){
      selectedIndex=null;
    } else {
      selectedIndex=currentIndex;
    }
    updateActive();
    return;
  }

  if(btn==="A"){
    if(selectedIndex===currentIndex){
      // increase value
      if(key==="answerTime") answerTime++;
      if(key==="revealTime") revealTime++;
    } else {
      // move up
      currentIndex = (currentIndex-1 + settingsItems.length) % settingsItems.length;
    }
    updateActive();
    updateDisplay();
  }

  if(btn==="B"){
    if(selectedIndex===currentIndex){
      // decrease value
      if(key==="answerTime" && answerTime>1) answerTime--;
      if(key==="revealTime" && revealTime>1) revealTime--;
    } else {
      // move down
      currentIndex = (currentIndex+1) % settingsItems.length;
    }
    updateActive();
    updateDisplay();
  }

  if(btn==="D"){ // save & back to menu
    localStorage.setItem("answerTime", answerTime);
    localStorage.setItem("revealTime", revealTime);
    window.location.href="index.html";
  }
});
</script>
</body>
</html>
