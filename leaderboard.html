<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Leaderboard - Byte by Byte</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{
  font-family:Arial,sans-serif;
  background:#0f172a;
  color:white;
  text-align:center;
  padding:20px;
}
h1{color:#fde047}
.scoreItem{
  background:#1e293b;
  margin:10px auto;
  width:320px;
  padding:15px;
  border-radius:12px;
  display:flex;
  gap:12px;
  align-items:center;
}
.active{background:#fde047;color:black}
.icon{font-size:1.5rem}
small{opacity:0.7}
</style>
</head>

<body>
<h1>ğŸ† TOP 10 LEADERBOARD</h1>
<div id="scores"></div>
<p>A/B scroll Â· D return</p>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getDatabase, ref, onValue, set } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

/* ğŸ”¥ FIREBASE CONFIG */
const firebaseConfig = {
  apiKey: "AIzaSyBkFUpf2JuYIch95wx9B4Rk-jp9I7IudJs",
  authDomain: "byte-by-byte-f7a4c.firebaseapp.com",
  databaseURL: "https://byte-by-byte-f7a4c-default-rtdb.firebaseio.com",
  projectId: "byte-by-byte-f7a4c",
  storageBucket: "byte-by-byte-f7a4c.firebasestorage.app",
  messagingSenderId: "838552047744",
  appId: "1:838552047744:web:f653b9fba96e49d665"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const leaderboardRef = ref(db,"leaderboard");
const controlRef = ref(db,"control");

const scoresDiv = document.getElementById("scores");
let entries=[];
let index=0;
const medals=["ğŸ¥‡","ğŸ¥ˆ","ğŸ¥‰"];

function render(){
  scoresDiv.innerHTML="";
  if(entries.length===0) return;

  const e = entries[index];
  const medal = index<3 ? medals[index] : `#${index+1}`;
  const date = new Date(e.timestamp).toLocaleString();

  scoresDiv.innerHTML=`
    <div class="scoreItem active">
      <span class="icon">${medal}</span>
      <div>
        <div>â­ Score: ${e.score}</div>
        <div>ğŸ”¥ Streak: ${e.streak}</div>
        <small>${date}</small>
      </div>
    </div>
  `;
}

onValue(leaderboardRef, snap=>{
  entries=[];
  snap.forEach(c=>{
    entries.push(c.val());
  });

  entries.sort((a,b)=> b.score - a.score || a.timestamp - b.timestamp);
  entries = entries.slice(0,10);
  index=0;
  render();
});

/* ğŸ”˜ ESP32 CONTROL */
onValue(controlRef,snap=>{
  const btn=snap.val()?.button;
  if(!btn) return;
  set(controlRef,{button:""});

  if(btn==="A") index=Math.max(0,index-1);
  if(btn==="B") index=Math.min(entries.length-1,index+1);
  if(btn==="D") window.location.href="index.html";

  render();
});
</script>
</body>
</html>
