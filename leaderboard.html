<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Leaderboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{background:#0f172a;color:white;text-align:center;font-family:Arial,sans-serif;padding:20px;}
h1{color:#fde047;}
#board{margin-top:20px;height:400px;overflow:hidden;position:relative;}
.entry{padding:10px;background:#334155;margin:5px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:1.2rem;}
.gold{color:#FFD700;font-weight:bold;}
.silver{color:#C0C0C0;font-weight:bold;}
.bronze{color:#CD7F32;font-weight:bold;}
</style>
</head>
<body>
<h1>Leaderboard</h1>
<div id="board">Loading...</div>
<p>Use A/B to scroll, C/D to go back to Menu</p>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getDatabase, ref, onValue, set } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyBkFUpf2JuYIch95wx9B4Rk-jp9I7IudJs",
  authDomain: "byte-by-byte-f7a4c.firebaseapp.com",
  databaseURL: "https://byte-by-byte-f7a4c-default-rtdb.firebaseio.com",
  projectId: "byte-by-byte-f7a4c",
  storageBucket: "byte-by-byte-f7a4c.firebasestorage.app",
  messagingSenderId: "838552047744",
  appId: "1:838552047744:web:f653b9fba96e49aa44d665"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const scoresRef = ref(db,'scores');
const controlRef = ref(db,"control");

const board = document.getElementById('board');
let entries = [];
let scrollIndex = 0;
const visibleCount = 5; // show 5 entries at a time

function renderBoard(){
  board.innerHTML='';
  const slice = entries.slice(scrollIndex,scrollIndex+visibleCount);
  slice.forEach((e,i)=>{
    const div=document.createElement('div');
    div.className='entry';
    if(scrollIndex+i===0) div.classList.add('gold');
    else if(scrollIndex+i===1) div.classList.add('silver');
    else if(scrollIndex+i===2) div.classList.add('bronze');
    div.textContent=`${e.name||'Player'} - ${e.score} pts`;
    board.appendChild(div);
  });
}

onValue(scoresRef,snapshot=>{
  const data = snapshot.val();
  if(!data){ board.innerHTML='No scores yet'; entries=[]; return; }
  entries = Object.values(data).sort((a,b)=>b.score-a.score);
  scrollIndex=0;
  renderBoard();
});

/* ESP32 buttons navigation */
onValue(controlRef,snapshot=>{
  const data = snapshot.val();
  if(!data||!data.button) return;
  const btn = data.button;
  set(controlRef,{button:""}); // reset

  if(btn==="C" || btn==="D"){ location.href='index.html'; }
  if(btn==="A"){ scrollIndex=Math.max(0,scrollIndex-1); renderBoard(); }
  if(btn==="B"){ scrollIndex=Math.min(entries.length-visibleCount,scrollIndex+1); renderBoard(); }
});
</script>
</body>
</html>
